<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; media-src 'self'; connect-src 'self' https://carlos-chat-proxy.vercel.app;">
  <title>Control — Carlos Tarrats</title>
  <meta name="description" content="Control: A text-only open-source on-device LLM app for iOS">

  <!-- Canonical -->
  <link rel="canonical" href="https://carlostarrats.github.io/projects/control.html">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="../favicon.svg?v=2">

  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Control — Carlos Tarrats">
  <meta property="og:description" content="Control: A text-only open-source on-device LLM app for iOS">
  <meta property="og:url" content="https://carlostarrats.github.io/projects/control.html">
  <meta property="og:image" content="https://carlostarrats.github.io/images/social.jpg?v=3">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Control — Carlos Tarrats">
  <meta name="twitter:description" content="Control: A text-only open-source on-device LLM app for iOS">
  <meta name="twitter:image" content="https://carlostarrats.github.io/images/social.jpg?v=3">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baskervville&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">

  <script>
    (function(){var t=sessionStorage.getItem('siteTheme');if(t&&t!=='default')document.documentElement.setAttribute('data-theme',t);})();
  </script>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <div class="top-bar">
    <div class="top-bar__colors">
      <button class="top-bar__swatch top-bar__swatch--default active" data-theme="default" aria-label="Default dark theme"></button>
      <button class="top-bar__swatch" data-theme="peach" aria-label="Peach theme"></button>
      <button class="top-bar__swatch" data-theme="pink" aria-label="Pink theme"></button>
      <button class="top-bar__swatch" data-theme="mint" aria-label="Mint theme"></button>
      <button class="top-bar__swatch" data-theme="yellow" aria-label="Yellow theme"></button>
      <button class="top-bar__swatch" data-theme="lavender" aria-label="Lavender theme"></button>
    </div>
    <button class="chat-trigger" id="chat-trigger" aria-label="Open chat with Carlos"><img src="../images/carlos-avatar.jpeg" alt="" class="chat-trigger__avatar"><span>Carlos LLM<span class="chat-trigger__suffix">: Ask me things</span></span></button>
  </div>
  <script>
    (function() {
      var swatches = document.querySelectorAll('.top-bar__swatch');
      var saved = sessionStorage.getItem('siteTheme') || 'default';
      swatches.forEach(function(s) {
        if (s.getAttribute('data-theme') === saved) {
          s.classList.add('active');
        } else {
          s.classList.remove('active');
        }
        s.addEventListener('click', function() {
          var theme = this.getAttribute('data-theme');
          swatches.forEach(function(el) { el.classList.remove('active'); });
          this.classList.add('active');
          if (theme === 'default') {
            document.documentElement.removeAttribute('data-theme');
            sessionStorage.removeItem('siteTheme');
          } else {
            document.documentElement.setAttribute('data-theme', theme);
            sessionStorage.setItem('siteTheme', theme);
          }
        });
      });
    })();
  </script>

  <!-- Preloader -->
  <div class="preloader" id="preloader">
    <div class="preloader__spinner"></div>
  </div>
  <script>
    (function() {
      var preloader = document.getElementById('preloader');
      if (sessionStorage.getItem('fontsLoaded')) {
        preloader.style.display = 'none';
      } else {
        var fontsReady = false;
        var minTimeReady = false;
        var loaded = false;
        function tryHide() {
          if (loaded || !fontsReady || !minTimeReady) return;
          loaded = true;
          sessionStorage.setItem('fontsLoaded', 'true');
          preloader.classList.add('is-hidden');
          setTimeout(function() {
            preloader.style.display = 'none';
          }, 400);
        }
        // Minimum 2s display time
        setTimeout(function() {
          minTimeReady = true;
          tryHide();
        }, 2000);
        // Hide when fonts ready AND min time elapsed
        function onFontsReady() {
          fontsReady = true;
          tryHide();
        }
        document.fonts.ready.then(onFontsReady);
        setTimeout(onFontsReady, 4000);
      }
    })();
  </script>

  <a href="#main-content" class="skip-link">Skip to main content</a>
  <div class="detail-page detail-page--control">
    <nav class="detail-nav">
      <a href="../index.html" class="back-link" aria-label="Back to homepage">Back</a>
      <a href="https://apps.apple.com/us/app/control-llm-interface/id6752229004" class="external-link" target="_blank" rel="noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="2" y1="12" x2="22" y2="12"></line>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        App Store
      </a>
    </nav>

    <article id="main-content" class="content-card">
      <header class="project-header">
        <div class="project-header__title">
          <span class="project-header__title-name project-header__title-name--control">Control </span><span class="project-header__title-dash">—</span> A text-only open-source on-device LLM app for iOS (Gemma3, Llama3.2, SmolLM2, Qwen3)
        </div>

        <div class="project-header__description">
          <p>I wanted an AI tool that kept everything local. Control runs open-source language models entirely on your device with no accounts, no data collection, and no network dependency. Your conversations stay on your phone and disappear each day.</p>
          <p>Upload PDFs for quick, on-device summaries without your documents ever leaving your phone. Customize colors and avatars to make it yours. Supports English, French, and Spanish. Built in Cursor.</p>
        </div>
      </header>

      <div class="view-toggle" role="tablist" aria-label="View mode">
        <button class="view-toggle__btn active" data-view="visual" role="tab" aria-selected="true" aria-controls="project-visual">Visual</button>
        <button class="view-toggle__btn" data-view="text" role="tab" aria-selected="false" aria-controls="project-text">Text</button>
      </div>

      <section class="project-images" id="project-visual" role="tabpanel">
        <img src="../images/control/control-hero.jpg" alt="Control app screenshots showing the logo, model selection, chat interface, and customization options" class="project-images__item">
        <div class="project-images__video">
          <video autoplay muted loop playsinline>
            <source src="../images/control/control-1.mp4" type="video/mp4">
          </video>
        </div>
        <div class="project-images__grid">
          <div class="project-images__video">
            <video autoplay muted loop playsinline>
              <source src="../images/control/control-2.mp4" type="video/mp4">
            </video>
          </div>
          <div class="project-images__video">
            <video autoplay muted loop playsinline>
              <source src="../images/control/control-3.mp4" type="video/mp4">
            </video>
          </div>
          <div class="project-images__video">
            <video autoplay muted loop playsinline>
              <source src="../images/control/control-4.mp4" type="video/mp4">
            </video>
          </div>
          <div class="project-images__video">
            <video autoplay muted loop playsinline>
              <source src="../images/control/control-5.mp4" type="video/mp4">
            </video>
          </div>
        </div>
      </section>

      <section class="project-text" id="project-text" role="tabpanel">
        <div class="project-text__section">
          <h3 class="project-text__heading">Problem</h3>
          <p class="project-text__body">I wanted to build an on-device AI app using open-source models, partly for privacy and partly to learn firsthand what small local models can and can't do. Most AI apps required accounts, sent data to servers, and offered no transparency about what happened with your conversations. There was no simple, free option that ran entirely on your phone with zero network dependency, no data collection, and no accounts. I also wanted to understand what building with these models actually felt like: what works, what breaks, and where the ceiling is when everything runs locally.</p>
        </div>
        <div class="project-text__section">
          <h3 class="project-text__heading">Process</h3>
          <p class="project-text__body">Started with much bigger ambitions: speech input, reactive avatar animations that responded to voice, and full PDF comprehension. Hitting the limitations of on-device models forced repeated pivots. Speech-to-text was too unreliable at small model sizes. PDF processing had to become a summary-based extraction using Vision and PDFKit rather than full document understanding, which sacrificed accuracy. The animated avatars required more processing overhead than the device could spare while running inference. The core inference layer itself needed an Objective-C++ bridge to llama.cpp with streaming token generation and manual memory management. Over 234 commits, the scope narrowed from an ambitious multimodal assistant into something focused and honest about what these models can actually do on a phone.</p>
        </div>
        <div class="project-text__section">
          <h3 class="project-text__heading">Solution</h3>
          <p class="project-text__body">A text-only iOS app that runs open-source LLMs entirely on-device using llama.cpp. Supports models from Google (Gemma 3), Meta (Llama 3.2), Hugging Face (SmolLM2), Alibaba (Qwen3), and Microsoft (Phi-3), all downloaded directly from Hugging Face and stored locally. The app is 8.9MB before model downloads. Conversations stay on your phone, reset within 24 hours, and are never transmitted anywhere. Features include PDF upload for on-device summaries, customizable colors and avatars, Metal shader visual effects, iOS Shortcuts integration for automation workflows, and support for English, French, and Spanish. Runs on iPhone and iPad. Built natively in Swift with IBM Plex Mono throughout and a dark-only minimal interface. Free with no subscriptions, open-sourced under Apache 2.0.</p>
        </div>
        <div class="project-text__section">
          <h3 class="project-text__heading">Outcome</h3>
          <p class="project-text__body">Live on the App Store at version 1.3. The project gave me a grounded understanding of what small on-device models are capable of and where they fall short. Gemma 3 and Qwen3 handle conversational tasks well, but anything requiring deep reasoning or long context breaks down fast. The constraints shaped the product into something deliberately minimal: no server costs, no user data to protect, and a genuine privacy story that's verifiable because the full source code is public. Open-sourced on GitHub with 234 commits across the full build.</p>
        </div>
      </section>
    </article>

    <footer class="detail-footer">
      <p class="body">© 2026</p>
    </footer>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // View toggle with crossfade
      var toggleBtns = document.querySelectorAll('.view-toggle__btn');
      var detailPage = document.querySelector('.detail-page');
      var images = document.querySelector('.project-images');
      var textSection = document.querySelector('.project-text');
      var isAnimating = false;
      toggleBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          if (this.classList.contains('active') || isAnimating) return;
          isAnimating = true;
          var goingToText = this.getAttribute('data-view') === 'text';
          var outgoing = goingToText ? images : textSection;
          var incoming = goingToText ? textSection : images;
          toggleBtns.forEach(function(b) {
            b.classList.remove('active');
            b.setAttribute('aria-selected', 'false');
          });
          this.classList.add('active');
          this.setAttribute('aria-selected', 'true');
          outgoing.style.opacity = '0';
          setTimeout(function() {
            if (goingToText) {
              detailPage.classList.add('is-text-mode');
            } else {
              detailPage.classList.remove('is-text-mode');
            }
            incoming.style.opacity = '0';
            void incoming.offsetHeight;
            incoming.style.opacity = '1';
            setTimeout(function() {
              outgoing.style.opacity = '';
              incoming.style.opacity = '';
              isAnimating = false;
            }, 200);
          }, 100);
        });
      });

      // Handle image loading
      document.querySelectorAll('.project-images__item').forEach(function(img) {
        if (img.complete) {
          img.classList.add('is-loaded');
        } else {
          img.addEventListener('load', function() {
            img.classList.add('is-loaded');
          });
        }
      });

      // Handle video loading
      document.querySelectorAll('.project-images__video').forEach(function(container) {
        var video = container.querySelector('video');
        if (video) {
          video.play().catch(function() {});
          if (video.readyState >= 3) {
            container.classList.add('is-loaded');
          } else {
            video.addEventListener('canplay', function() {
              container.classList.add('is-loaded');
            });
          }
        }
      });
    });
  </script>
  <!-- Chat Panel -->
  <div class="chat-overlay" id="chat-overlay">
    <div class="chat-phone-wrap">
      <button class="chat-close" id="chat-close" aria-label="Close chat">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
      <svg class="chat-phone-frame" viewBox="0 0 1049 2147" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M1039.38 339.499H1037.36V127.359C1037.36 57.02 980.335 0 909.997 0H138.014C67.6755 0 10.6555 57.02 10.6555 127.359V339.499H8.6335C-0.550498 339.499 0.00651861 346.943 0.00651861 356.126V502.871C0.00651861 512.055 -0.550498 519.498 8.6335 519.498H10.6555V554.498H8.6335C-0.550498 554.498 0.00651861 561.942 0.00651861 571.125V717.87C0.00651861 727.054 -0.550498 734.497 8.6335 734.497H10.6555V2019.64C10.6555 2089.98 67.6765 2147 138.014 2147H909.996C980.335 2147 1037.35 2089.98 1037.35 2019.64V609.499H1039.38C1048.56 609.499 1048 602.055 1048 592.872V356.126C1048 346.943 1048.56 339.499 1039.38 339.499Z" fill="#333343"/>
      </svg>
      <div class="chat-panel" id="chat-panel" role="dialog" aria-label="Chat with Carlos">
        <div class="chat-messages" id="chat-messages">
          <div class="chat-welcome" id="chat-welcome">
            <p class="chat-welcome__text"><img src="../images/carlos-avatar.jpeg" alt="" class="chat-welcome__avatar">Hey, ask away.</p>
            <div class="chat-starters" id="chat-starters">
              <button class="chat-starter">What kind of work are you looking for?</button>
              <button class="chat-starter">Tell me about your time at DDS</button>
              <button class="chat-starter">What's your design philosophy?</button>
              <button class="chat-starter">What are you building right now?</button>
            </div>
          </div>
        </div>
        <div class="chat-input-area">
          <div class="chat-input-wrap">
            <input type="text" class="chat-input" id="chat-input" placeholder="Carlos LLM" maxlength="500" autocomplete="off">
            <button class="chat-send" id="chat-send" aria-label="Send message" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function() {
      var PROXY_URL = 'https://carlos-chat-proxy.vercel.app/api/chat';
      var trigger = document.getElementById('chat-trigger');
      var overlay = document.getElementById('chat-overlay');
      var closeBtn = document.getElementById('chat-close');
      var messagesEl = document.getElementById('chat-messages');
      var welcomeEl = document.getElementById('chat-welcome');
      var startersEl = document.getElementById('chat-starters');
      var input = document.getElementById('chat-input');
      var sendBtn = document.getElementById('chat-send');
      var messages = [];
      var isLoading = false;
      var pageContext = (function() { var parts = []; var t = document.querySelector('.project-header__title'); if (t) parts.push(t.textContent.trim()); document.querySelectorAll('.project-header__description p').forEach(function(p) { parts.push(p.textContent.trim()); }); document.querySelectorAll('.project-text__section').forEach(function(s) { parts.push(s.textContent.trim()); }); return parts.join('\n\n'); })();
      function openChat() { overlay.classList.add('is-open'); document.body.style.overflow = 'hidden'; input.focus(); }
      function closeChat() { overlay.classList.remove('is-open'); document.body.style.overflow = ''; }
      trigger.addEventListener('click', openChat);
      closeBtn.addEventListener('click', closeChat);
      overlay.addEventListener('click', function(e) { if (e.target === overlay) closeChat(); });
      document.addEventListener('keydown', function(e) { if (e.key === 'Escape' && overlay.classList.contains('is-open')) closeChat(); });
      input.addEventListener('input', function() { sendBtn.disabled = !input.value.trim() || isLoading; });
      input.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !sendBtn.disabled) sendMessage(input.value.trim()); });
      sendBtn.addEventListener('click', function() { if (!sendBtn.disabled) sendMessage(input.value.trim()); });
      startersEl.addEventListener('click', function(e) { var btn = e.target.closest('.chat-starter'); if (btn) sendMessage(btn.textContent); });
      function addMessageEl(role, content) { var div = document.createElement('div'); div.className = 'chat-msg chat-msg--' + (role === 'user' ? 'user' : 'bot'); div.textContent = content; messagesEl.appendChild(div); messagesEl.scrollTop = messagesEl.scrollHeight; return div; }
      function addTypingIndicator() { var div = document.createElement('div'); div.className = 'chat-msg chat-msg--bot'; div.id = 'chat-typing'; var dots = document.createElement('div'); dots.className = 'chat-typing'; dots.appendChild(document.createElement('span')); dots.appendChild(document.createElement('span')); dots.appendChild(document.createElement('span')); div.appendChild(dots); messagesEl.appendChild(div); messagesEl.scrollTop = messagesEl.scrollHeight; }
      function removeTypingIndicator() { var el = document.getElementById('chat-typing'); if (el) el.remove(); }
      function sendMessage(text) {
        if (!text || isLoading) return;
        if (welcomeEl) { welcomeEl.remove(); welcomeEl = null; }
        messages.push({ role: 'user', content: text }); addMessageEl('user', text);
        input.value = ''; sendBtn.disabled = true; isLoading = true; addTypingIndicator();
        fetch(PROXY_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: 'omit', body: JSON.stringify({ messages: messages, pageContext: pageContext }) })
        .then(function(res) { if (!res.ok) { if (res.status === 429) throw new Error('Slow down a bit, try again in a minute.'); throw new Error('Something went wrong. Try again.'); } return res.json(); })
        .then(function(data) { removeTypingIndicator(); var reply = data.response || "Hmm, don't have an answer for that right now. Try asking me something else."; messages.push({ role: 'assistant', content: reply }); addMessageEl('bot', reply); })
        .catch(function(err) { removeTypingIndicator(); var errDiv = document.createElement('div'); errDiv.className = 'chat-error'; errDiv.textContent = err.message; messagesEl.appendChild(errDiv); messagesEl.scrollTop = messagesEl.scrollHeight; })
        .finally(function() { isLoading = false; sendBtn.disabled = !input.value.trim(); });
      }
    })();
  </script>
</body>
</html>
